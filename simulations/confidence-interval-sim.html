<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confidence Interval Simulation</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .control-group {
            display: flex;
            flex-direction: column;
        }
        label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }
        input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }
        .value-display {
            text-align: center;
            color: #007bff;
            font-weight: bold;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
        #chart {
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .stat-box {
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 5px;
            text-align: center;
        }
        .stat-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        .explanation {
            margin-top: 30px;
            padding: 20px;
            background-color: #e8f4f8;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .coverage-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .covered { background-color: #28a745; }
        .not-covered { background-color: #dc3545; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Confidence Interval Simulation</h1>
        
        <div class="controls">
            <div class="control-group">
                <label for="sampleSize">Sample Size:</label>
                <input type="range" id="sampleSize" min="10" max="200" value="30" step="5">
                <div class="value-display" id="sampleSizeValue">30</div>
            </div>
            
            <div class="control-group">
                <label for="confidenceLevel">Confidence Level:</label>
                <input type="range" id="confidenceLevel" min="80" max="99" value="95" step="1">
                <div class="value-display" id="confidenceLevelValue">95%</div>
            </div>
            
            <div class="control-group">
                <label for="popMean">Population Mean (μ):</label>
                <input type="range" id="popMean" min="40" max="60" value="50" step="0.5">
                <div class="value-display" id="popMeanValue">50</div>
            </div>
            
            <div class="control-group">
                <label for="popStd">Population Std Dev (σ):</label>
                <input type="range" id="popStd" min="1" max="20" value="10" step="0.5">
                <div class="value-display" id="popStdValue">10</div>
            </div>
        </div>
        
        <div style="text-align: center;">
            <button onclick="generateSamples()">Generate New Samples</button>
            <button onclick="runSimulation()">Run 100 Simulations</button>
        </div>
        
        <canvas id="chart" width="900" height="400"></canvas>
        
        <div class="stats">
            <div class="stat-box">
                <div class="stat-label">Current Sample Mean</div>
                <div class="stat-value" id="sampleMean">-</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Margin of Error</div>
                <div class="stat-value" id="marginError">-</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Confidence Interval</div>
                <div class="stat-value" id="confInterval">-</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Coverage Rate</div>
                <div class="stat-value" id="coverageRate">-</div>
            </div>
        </div>
        
        <div class="explanation">
            <h3>Understanding Confidence Intervals</h3>
            <p>A confidence interval gives us a range of plausible values for an unknown population parameter. The confidence level (e.g., 95%) tells us how often the interval would contain the true parameter if we repeated the sampling process many times.</p>
            <p><strong>Key Points:</strong></p>
            <ul>
                <li>The confidence level is NOT the probability that the parameter lies within a specific interval</li>
                <li>It's the long-run proportion of intervals that contain the true parameter</li>
                <li>Wider intervals → higher confidence; Narrower intervals → lower confidence</li>
                <li>Larger sample sizes → narrower intervals (more precision)</li>
            </ul>
            <p><span class="coverage-indicator covered"></span>Green intervals contain the true mean</p>
            <p><span class="coverage-indicator not-covered"></span>Red intervals do not contain the true mean</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('chart');
        const ctx = canvas.getContext('2d');
        let intervals = [];
        let currentSample = [];
        
        // Update slider values
        document.querySelectorAll('input[type="range"]').forEach(slider => {
            slider.addEventListener('input', (e) => {
                const valueDisplay = document.getElementById(e.target.id + 'Value');
                if (e.target.id === 'confidenceLevel') {
                    valueDisplay.textContent = e.target.value + '%';
                } else {
                    valueDisplay.textContent = e.target.value;
                }
            });
        });
        
        function normalRandom(mean, std) {
            let u = 0, v = 0;
            while (u === 0) u = Math.random();
            while (v === 0) v = Math.random();
            return mean + std * Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
        }
        
        function generateSample(n, mean, std) {
            const sample = [];
            for (let i = 0; i < n; i++) {
                sample.push(normalRandom(mean, std));
            }
            return sample;
        }
        
        function calculateStats(sample) {
            const n = sample.length;
            const mean = sample.reduce((a, b) => a + b, 0) / n;
            const variance = sample.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / (n - 1);
            const std = Math.sqrt(variance);
            return { mean, std, n };
        }
        
        function getZScore(confidenceLevel) {
            const alpha = 1 - confidenceLevel / 100;
            // Using approximation for z-scores
            const zScores = {
                80: 1.282, 85: 1.440, 90: 1.645, 95: 1.960, 99: 2.576
            };
            return zScores[confidenceLevel] || 1.960;
        }
        
        function calculateCI(sampleMean, sampleStd, n, confidenceLevel) {
            const z = getZScore(confidenceLevel);
            const marginError = z * (sampleStd / Math.sqrt(n));
            return {
                lower: sampleMean - marginError,
                upper: sampleMean + marginError,
                marginError: marginError
            };
        }
        
        function generateSamples() {
            const n = parseInt(document.getElementById('sampleSize').value);
            const popMean = parseFloat(document.getElementById('popMean').value);
            const popStd = parseFloat(document.getElementById('popStd').value);
            const confidenceLevel = parseInt(document.getElementById('confidenceLevel').value);
            
            currentSample = generateSample(n, popMean, popStd);
            const stats = calculateStats(currentSample);
            const ci = calculateCI(stats.mean, stats.std, stats.n, confidenceLevel);
            
            intervals = [{
                mean: stats.mean,
                lower: ci.lower,
                upper: ci.upper,
                contains: ci.lower <= popMean && popMean <= ci.upper
            }];
            
            updateDisplay(stats, ci);
            drawChart();
        }
        
        function runSimulation() {
            const n = parseInt(document.getElementById('sampleSize').value);
            const popMean = parseFloat(document.getElementById('popMean').value);
            const popStd = parseFloat(document.getElementById('popStd').value);
            const confidenceLevel = parseInt(document.getElementById('confidenceLevel').value);
            
            intervals = [];
            
            for (let i = 0; i < 100; i++) {
                const sample = generateSample(n, popMean, popStd);
                const stats = calculateStats(sample);
                const ci = calculateCI(stats.mean, stats.std, stats.n, confidenceLevel);
                
                intervals.push({
                    mean: stats.mean,
                    lower: ci.lower,
                    upper: ci.upper,
                    contains: ci.lower <= popMean && popMean <= ci.upper
                });
            }
            
            const coverageRate = intervals.filter(ci => ci.contains).length;
            document.getElementById('coverageRate').textContent = coverageRate + '%';
            
            drawChart();
        }
        
        function updateDisplay(stats, ci) {
            document.getElementById('sampleMean').textContent = stats.mean.toFixed(2);
            document.getElementById('marginError').textContent = '±' + ci.marginError.toFixed(2);
            document.getElementById('confInterval').textContent = 
                `[${ci.lower.toFixed(2)}, ${ci.upper.toFixed(2)}]`;
        }
        
        function drawChart() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (intervals.length === 0) return;
            
            const popMean = parseFloat(document.getElementById('popMean').value);
            const padding = 40;
            const chartWidth = canvas.width - 2 * padding;
            const chartHeight = canvas.height - 2 * padding;
            
            // Find min and max values for scaling
            let minVal = Infinity, maxVal = -Infinity;
            intervals.forEach(ci => {
                minVal = Math.min(minVal, ci.lower);
                maxVal = Math.max(maxVal, ci.upper);
            });
            minVal = Math.min(minVal, popMean - 5);
            maxVal = Math.max(maxVal, popMean + 5);
            
            const scale = chartWidth / (maxVal - minVal);
            const intervalHeight = Math.min(chartHeight / intervals.length, 20);
            
            // Draw population mean line
            ctx.strokeStyle = '#007bff';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            const popMeanX = padding + (popMean - minVal) * scale;
            ctx.moveTo(popMeanX, padding);
            ctx.lineTo(popMeanX, canvas.height - padding);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Label for population mean
            ctx.fillStyle = '#007bff';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`μ = ${popMean}`, popMeanX, padding - 10);
            
            // Draw confidence intervals
            intervals.forEach((ci, index) => {
                const y = padding + index * intervalHeight + intervalHeight / 2;
                const x1 = padding + (ci.lower - minVal) * scale;
                const x2 = padding + (ci.upper - minVal) * scale;
                const xMean = padding + (ci.mean - minVal) * scale;
                
                // Interval line
                ctx.strokeStyle = ci.contains ? '#28a745' : '#dc3545';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(x1, y);
                ctx.lineTo(x2, y);
                ctx.stroke();
                
                // End caps
                ctx.beginPath();
                ctx.moveTo(x1, y - 5);
                ctx.lineTo(x1, y + 5);
                ctx.moveTo(x2, y - 5);
                ctx.lineTo(x2, y + 5);
                ctx.stroke();
                
                // Sample mean point
                ctx.fillStyle = ci.contains ? '#28a745' : '#dc3545';
                ctx.beginPath();
                ctx.arc(xMean, y, 3, 0, 2 * Math.PI);
                ctx.fill();
            });
            
            // Draw axis
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();
            
            // Axis labels
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            for (let i = 0; i <= 5; i++) {
                const val = minVal + (maxVal - minVal) * i / 5;
                const x = padding + chartWidth * i / 5;
                ctx.fillText(val.toFixed(1), x, canvas.height - padding + 20);
            }
        }
        
        // Initialize
        generateSamples();
    </script>
</body>
</html>